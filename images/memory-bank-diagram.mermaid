flowchart TD
    %% Define styles
    classDef process fill:#f4f4f4,stroke:#333,stroke-width:1px,border-radius:5px
    classDef decision fill:#ffe6cc,stroke:#d79b00,stroke-width:1px,border-radius:10px
    classDef bottleneck fill:#f8cecc,stroke:#b85450,stroke-width:1px,border-radius:5px
    classDef checkpoint fill:#d5e8d4,stroke:#82b366,stroke-width:1px,border-radius:5px
    classDef section fill:#fff2cc,stroke:#d6b656,stroke-width:1px,rounded:true
    
    %% Initial Setup section
    subgraph Setup ["1. INITIAL SETUP"]
        direction LR
        start([Start]) --> checkFiles{File<br>Check}
        checkFiles -->|Missing| createFiles[Create Files]
        checkFiles -->|Exist| platformDetect[Platform<br>Detection]
        createFiles --> platformDetect
    end
    
    %% Planning section
    subgraph Planning ["2. PLANNING PHASE"]
        direction LR
        init[INITIALIZATION] --> checkMB{Review<br>Memory Bank}
        checkMB --> docSetup[DOC SETUP]
        docSetup --> updateMB[Update MB]
        updateMB --> planning[TASK PLANNING]
        planning --> taskPlan[Create Plan<br>in tasks.md]
    end
    
    %% Implementation section
    subgraph Implementation ["3. IMPLEMENTATION"]
        direction LR
        impl[IMPLEMENTATION] --> execCmd[Execute<br>Commands]
        execCmd -->|One at a Time| updateTask[Update<br>tasks.md]
        updateTask --> addImpl[Update<br>activeContext]
        addImpl -->|More Steps| execCmd
        addImpl -->|Complete| reflectStart[Ready for<br>Reflection]
    end
    
    %% Reflection and Archiving
    subgraph Completion ["4. COMPLETION"]
        direction LR
        reflect[REFLECTION] --> reflect4[Document<br>4 Sections]
        reflect4 --> archive[ARCHIVING]
        archive --> archiveTask[Create<br>Archive]
        archiveTask --> crossLink[Create<br>Cross-Links]
    end
    
    %% Verification System section
    subgraph Verification ["5. VERIFICATION"]
        direction LR
        verify[Verify] --> checkAll{All Checks<br>Pass?}
        checkAll -->|No| fixIssues[Fix Issues]
        fixIssues --> verify
        checkAll -->|Yes| complete([Complete])
    end
    
    %% References connections on the side
    subgraph References ["REFERENCE REQUIREMENTS"]
        direction TB
        ref1[workflow-examples]
        ref2[command-examples]
        ref3[reflection-examples]
        ref4[archive-examples]
    end
    
    %% Connect major sections vertically
    Setup --> Planning
    Planning --> Implementation
    Implementation --> Completion
    Completion --> Verification
    
    %% Connect workflow between sections
    platformDetect --> init
    taskPlan --> impl
    reflectStart --> reflect
    crossLink --> verify
    
    %% Connect references
    init -.-> ref1
    impl -.-> ref2
    reflect -.-> ref3
    archive -.-> ref4
    
    %% Apply styles
    class start,complete process
    class checkFiles,checkMB,checkAll decision
    class createFiles,platformDetect,init,docSetup,planning,impl,reflect,archive,reflect4 process
    class execCmd,updateMB bottleneck
    class updateTask,verify checkpoint
    class Setup,Planning,Implementation,Completion,Verification,References section